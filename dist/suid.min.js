/*! [Suid 0.9.8](http://download.github.io/suid) copyright 2015 by [Stijn de Witt](http://StijnDeWitt.com), some rights reserved. Licensed under [Creative Commons Attribution 4.0 International (CC BY 4.0)](https://creativecommons.org/licenses/by/4.0/) */
!function(){"use strict";function a(){var a={},b=document.querySelector("script[data-suid-server]");if(!b)return m&&console.error("Attribute `data-suid-server` not found on any script element. Unable to fetch suids from the server."),a;var c=b.getAttribute("data-suid-server"),e=b.getAttribute("data-suid-options");if(e)try{a=JSON.parse(e.split("'").join('"'))}catch(f){m&&console.error("Unable to parse suid options as JSON: '"+e+"'. Error was: ",f)}return a.url=c,a}var b,c,e="Suid:",f="suidpool",g="suiddetect",h="0123456789acdefghijkmnprstuvwxyz",j=[["b","00"],["l","01"],["o","02"],["q","03"]],k=h+"bloq",l=function(a){try{return a.setItem(g,g),a.removeItem(g),!0}catch(b){return!1}}(localStorage),m=window.console&&console.error,n=a(),o={url:n.url,min:n.min||2,max:n.max||2},Suid=function(){function Suid(a){return void 0===a?Suid.next():("string"==typeof a&&(a=Suid.fromString(a)),this.value=a instanceof Suid?a.value:a,void Number.call(this,this.value))}return Suid.prototype=Object.create(Number.prototype),Suid.prototype.toString=function(){return Suid.compress(this.toBase32())},Suid.prototype.toJSON=function(){return e+this.toString()},Suid.prototype.toBase32=function(){for(var a=this.valueOf(),b="",c="",i=0;11>i;i++){var e=31&a;e?(b=h.charAt(e)+c+b,c=""):c+="0",a/=32}return b},Suid.prototype.toJSON=function(){return"Suid:"+this.toString()},Suid.prototype.valueOf=function(){return this.value},Suid.fromString=function(a){return Suid.fromBase32(Suid.decompress(a))},Suid.fromBase32=function(a){for(var b=0,i=0;i<a.length;i++){var c=h.indexOf(a.charAt(i));b=32*b+c}return new Suid(b)},Suid.fromJSON=function(a){return null===a?null:(a.indexOf(e)||(a=a.substr(e.length)),Suid.fromString(a))},Suid.looksValid=function(a){if(!a)return!1;var b=a.length;if(!b||b>11)return!1;if(11===b&&h.indexOf(a.charAt(0))>8)return!1;for(var i=0;b>i;i++)if(-1===k.indexOf(a.charAt(i)))return!1;return!0},Suid.looksValidJSON=function(a){return a&&a.length?-1===a.indexOf(e)?!1:Suid.looksValid(a.substr(e.length)):!1},Suid.revive=function(a,b){return Suid.looksValidJSON(b)?Suid.fromJSON(b):b},Suid.compress=function(a){for(var b,i=0;b=j[i];i++)a=a.replace(new RegExp(b[1],"g"),b[0]);return a},Suid.decompress=function(a){for(var b,i=0;b=j[i];i++)a=a.replace(new RegExp(b[0],"g"),b[1]);return a},Suid.next=function(){var a=p.get();if(a.length<o.min&&q.fetch(),!b){var a=p.get();if(0===a.length)throw new Error("Unable to generate IDs. Suid block pool exhausted.");c=0,b=a.splice(0,1)[0],p.set(a)}var e=b+4*c;return c++,c>255&&(b=null),new Suid(e)},Suid}(),p=function(){var a=[];return{get:function(){return l&&(a=p.from(localStorage.getItem(f))),a},set:function(b){return a=b,l&&localStorage.setItem(f,p.to(a)),p},from:function(a){var b=[];if(a)for(var c,e=a.split(","),i=0;c=e[i];i++)b.push(new Suid(c));return b},to:function(a){return a.join(",")}}}(),q=function(){function a(a){h=0;var b=p.get();b.push(JSON.parse(a)),p.set(b)}function e(a,b){switch(a){case 500:case 502:case 503:case 504:f(b);break;default:m&&console.error("Unable to fetch suid data from server. ",b,a),h=0,j=0}}function f(f){if(0===h)return void(m&&console.error("Giving up fetching suid data after 5 attempts to fetch from server url: "+o.url));h--;var j=3e5,k=f.getResponseHeader("Retry-After");k&&(j=parseInt(k,10),isNaN(j)||(j=1e3*j)),p.get().length||j>6e4&&(j=6e4),c>100&&j>3e4&&(j=3e4),b||j>1e3&&(j=1e3),setTimeout(function(){g(o.url,{blocks:o.max-p.get().length},a,e)},j)}function g(a,b,c,e,f){var g,h,j=new XMLHttpRequest,k=[];for(h in b)b.hasOwnProperty(h)&&k.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));g=k.join("&"),j.open("get",a+(g?(-1!==a.indexOf("?")?"&":"?")+g:""),!f),j.addEventListener("readystatechange",function(){4===this.readyState&&(200===this.status?c(this.responseText,this):e(this.status,this))}),j.addEventListener("error",function(){e(this,this.status)}),j.send()}var h=0,j=0;return{fetch:function(){if(!h||!((new Date).getTime()-j<5e3||c&&100>c)){var b=p.get();b.length<o.min&&(h=3,j=Date.now(),g(o.url,{blocks:o.max-b.length},a,e))}}}}();q.fetch(),window.Suid=Suid}();
//# sourceMappingURL=suid.min.js.map