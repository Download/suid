/*! [Suid 0.9.6](http://download.github.io/suid) copyright 2015 by [Stijn de Witt](http://StijnDeWitt.com), some rights reserved. Licensed under [Creative Commons Attribution 4.0 International (CC BY 4.0)](https://creativecommons.org/licenses/by/4.0/) */
!function(){"use strict";function a(){var a={},b=document.querySelector("script[data-suid-server]");if(!b)return k&&console.error("Attribute `data-suid-server` not found on any script element. Unable to fetch suids from the server."),a;var c=b.getAttribute("data-suid-server"),e=b.getAttribute("data-suid-options");if(e)try{a=JSON.parse(e.split("'").join('"'))}catch(f){k&&console.error("Unable to parse suid options as JSON: '"+e+"'. Error was: ",f)}return a.url=c,a}var b,c,e="suidpool",f="suiddetect",g="0123456789acdefghijkmnprstuvwxyz",h=[["b","00"],["l","01"],["o","02"],["q","03"]],j=function(a){try{return a.setItem(f,f),a.removeItem(f),!0}catch(b){return!1}}(localStorage),k=window.console&&console.error,l=a(),m={url:l.url,min:l.min||2,max:l.max||2},Suid=function(){function Suid(b){return this instanceof Suid?(this.value="string"==typeof b?Suid.fromString(b).value:b instanceof Suid?b.value:b,void Number.call(this,this.value)):a()}function a(){if(!b){o.fetch();var a=n.get();if(0===a.length)throw new Error("Unable to generate IDs. Suid block pool exhausted.");c=0,b=a.splice(0,1)[0],n.set(a)}var e=b+4*c;return c++,c>255&&(b=null),new Suid(e)}return Suid.prototype=Object.create(Number.prototype),Suid.prototype.toString=function(){return Suid.compress(this.toBase32())},Suid.prototype.toBase32=function(){for(var a=this.valueOf(),b="",c="",i=0;11>i;i++){var e=31&a;e?(b=g.charAt(e)+c+b,c=""):c+="0",a/=32}return b},Suid.prototype.valueOf=function(){return this.value},Suid.fromString=function(a){return Suid.fromBase32(Suid.decompress(a))},Suid.fromBase32=function(a){for(var b=0,i=0;i<a.length;i++){var c=g.indexOf(a.charAt(i));b=32*b+c}return new Suid(b)},Suid.compress=function(a){for(var b,i=0;b=h[i];i++)a=a.replace(new RegExp(b[1],"g"),b[0]);return a},Suid.decompress=function(a){for(var b,i=0;b=h[i];i++)a=a.replace(new RegExp(b[0],"g"),b[1]);return a},Suid}(),n=function(){var a=[];return{get:function(){return j&&(a=n.from(localStorage.getItem(e))),a},set:function(b){return a=b,j&&localStorage.setItem(e,n.to(a)),n},from:function(a){var b=[];if(a)for(var c,e=a.split(","),i=0;c=e[i];i++)b.push(new Suid(c));return b},to:function(a){return a.join(",")}}}(),o=function(){function a(a){h=0,j=0;var b=n.get();b.push(JSON.parse(a)),n.set(b)}function e(a,b){switch(a){case 500:case 502:case 503:case 504:f(b);break;default:k&&console.error("Unable to fetch suid data from server. ",b,a),h=0,j=0}}function f(f){if(0===h)return j=0,void(k&&console.error("Giving up fetching suid data after 5 attempts to fetch from server url: "+m.url));h--;var l=3e5,o=f.getResponseHeader("Retry-After");o&&(l=parseInt(o,10),isNaN(l)||(l=1e3*l)),n.get().length||l>6e4&&(l=6e4),c>100&&l>3e4&&(l=3e4),b||l>1e3&&(l=1e3),setTimeout(function(){g(m.url,{blocks:m.max-n.get().length},a,e)},l)}function g(a,b,c,e,f){var g,h,j=new XMLHttpRequest,k=[];for(h in b)b.hasOwnProperty(h)&&k.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));g=k.join("&"),j.open("get",a+(g?(-1!==a.indexOf("?")?"&":"?")+g:""),!f),j.addEventListener("readystatechange",function(){4===this.readyState&&(200===this.status?c(this.responseText,this):e(this.status,this))}),j.addEventListener("error",function(){e(this,this.status)}),j.send()}var h=0,j=0;return{fetch:function(){if(!h||!((new Date).getTime()-j<5e3||c&&100>c)){var b=n.get();b.length<m.min&&(h=3,j=Date.now(),g(m.url,{blocks:m.max-b.length},a,e))}}}}();o.fetch(),window.Suid=Suid}();
//# sourceMappingURL=suid.min.js.map