/*! [Suid 0.9.10](http://download.github.io/suid) copyright 2015 by [Stijn de Witt](http://StijnDeWitt.com), some rights reserved. Licensed under [Creative Commons Attribution 4.0 International (CC BY 4.0)](https://creativecommons.org/licenses/by/4.0/) */
!function(){"use strict";function a(){var a={},b=document.querySelector("script[data-suid-server]");if(!b)return n&&console.error("Attribute `data-suid-server` not found on any script element. Unable to fetch suids from the server."),a;var c=b.getAttribute("data-suid-server"),e=b.getAttribute("data-suid-options");if(e)try{a=JSON.parse(e.split("'").join('"'))}catch(f){n&&console.error("Unable to parse suid options as JSON: '"+e+"'. Error was: ",f)}return a.url=c,a}var b,c,e="Suid:",f=4,g=32,h=5e3,j="suidpool",k="suiddetect",l="0123456789abcdefghijklmnopqrstuvwxyz",m=function(a){try{return a.setItem(k,k),a.removeItem(k),!0}catch(b){return!1}}(localStorage),n=window.console&&console.error,o=a(),p={url:o.url,min:o.min||3,max:o.max||4},Suid=function(){function Suid(a){return this instanceof Suid?void 0===a?Suid.next():("string"==typeof a&&(a=Suid.fromString(a)),this.value=a instanceof Suid?a.value:a,void Number.call(this,this.value)):new Suid(a)}return Suid.prototype=Object.create(Number.prototype),Suid.NULL=Suid(0),Suid.prototype.toString=function(){return this.value.toString(36)},Suid.prototype.toJSON=function(){return e+this.toString()},Suid.prototype.valueOf=function(){return this.value},Suid.fromString=function(a){return new Suid(parseInt(a,36))},Suid.fromJSON=function(a){return null===a?null:(a.indexOf(e)||(a=a.substr(e.length)),Suid.fromString(a))},Suid.looksValid=function(a){if(!a)return!1;var b=a.length;if(!b||b>11)return!1;if(11===b&&l.indexOf(a.charAt(0))>2)return!1;for(var i=0;b>i;i++)if(-1===l.indexOf(a.charAt(i)))return!1;return!0},Suid.looksValidJSON=function(a){return a&&a.length?-1===a.indexOf(e)?!1:Suid.looksValid(a.substr(e.length)):!1},Suid.revive=function(a,b){return Suid.looksValidJSON(b)?Suid.fromJSON(b):b},Suid.next=function(){var a=q.get();if((a.length<p.min||!b&&a.length===p.min)&&r.fetch(),!b){if(0===a.length)throw new Error("Unable to generate IDs. Suid block pool exhausted.");c=0,b=a.splice(0,1)[0],q.set(a)}var e=b+c*f;return c++,c>=g&&(b=null),new Suid(e)},Suid}(),q=function(){var a=[];return{get:function(){return m&&(a=q.from(localStorage.getItem(j))),a},set:function(b){return a=b,m&&localStorage.setItem(j,q.to(a)),q},from:function(a){var b=[];if(a)for(var c,e=a.split(","),i=0;c=e[i];i++)b.push(new Suid(c));return b},to:function(a){return a.join(",")}}}(),r=function(){function a(a){k=0;var b=q.get();b.push(JSON.parse(a)),q.set(b)}function e(a,b){switch(a){case 500:case 502:case 503:case 504:f(b);break;default:n&&console.error("Unable to fetch suid data from server. ",b,a),k=0,l=0}}function f(f){if(0===k)return void(n&&console.error("Giving up fetching suid data after 5 attempts to fetch from server url: "+p.url));k--;var h=3e5,l=f.getResponseHeader("Retry-After");l&&(h=parseInt(l,10),isNaN(h)||(h=1e3*h)),q.get().length||h>6e4&&(h=6e4),c>g/2&&h>3e4&&(h=3e4),b||h>1e3&&(h=1e3),setTimeout(function(){j(p.url,{blocks:p.max-q.get().length},a,e)},h)}function j(a,b,c,e,f){var g,h,j=new XMLHttpRequest,k=[];for(h in b)b.hasOwnProperty(h)&&k.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));g=k.join("&"),j.open("get",a+(g?(-1!==a.indexOf("?")?"&":"?")+g:""),!f),j.addEventListener("readystatechange",function(){4===this.readyState&&(200===this.status?c(this.responseText,this):e(this.status,this))}),j.addEventListener("error",function(){e(this,this.status)}),j.send()}var k=0,l=0;return{fetch:function(){if(!k||!((new Date).getTime()-l<h||c&&g/2>c)){var b=q.get();b.length<p.min&&(k=3,l=Date.now(),j(p.url,{blocks:p.max-b.length},a,e))}}}}();r.fetch(),window.Suid=Suid}();
//# sourceMappingURL=suid.min.js.map