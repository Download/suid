/*! Suid 0.9.2 | Stijn de Witt StijnDeWitt.com | CC0 1.0 Universal License | github.com/Download/suid */
!function(){"use strict";function a(){var a={},b=document.querySelector("script[data-suid-url]");if(!b)return i&&console.error("Attribute `data-suid-url` not found on any script element. Unable to fetch suids from the server."),a;var c=b.getAttribute("data-suid-url"),d=b.getAttribute("data-suid-options");if(d)try{a=JSON.parse(d.split("'").join('"'))}catch(e){i&&console.error("Unable to parse suid options as JSON: '"+d+"'. Error was: ",e)}return a.url=c,a}var b,c,d="suidpool",e="suiddetect",f="0123456789acdefghijkmnprstuvwxyz",g=[["b","00"],["l","01"],["o","02"],["q","03"]],h=function(a){try{return a.setItem(e,e),a.removeItem(e),!0}catch(b){return!1}}(localStorage),i=window.console&&console.error,j=a(),k={url:j.url,min:j.min||2,max:j.max||2},l=function(){function a(b){return this instanceof a?void Number.call(this,this.value="string"==typeof b?a.fromString(b):b):d()}function d(){if(!b){n.fetch();var d=m.get();if(0===d.length)throw new Error("Unable to generate IDs. Suid block pool exhausted.");c=0,b=d.splice(0,1)[0],m.set(d)}var e=b+4*c;return c++,c>255&&(b=null),new a(e)}return a.prototype=Object.create(Number.prototype),a.prototype.toString=function(){return a.compress(this.toBase32())},a.prototype.toBase32=function(){for(var a=this.valueOf(),b="",c="",d=0;11>d;d++){var e=31&a;e?(b=f.charAt(e)+c+b,c=""):c+="0",a/=32}return b},a.prototype.valueOf=function(){return this.value},a.fromString=function(b){return a.fromBase32(a.decompress(b))},a.fromBase32=function(b){for(var c=0,d=0;d<b.length;d++){var e=f.indexOf(b.charAt(d));c=32*c+e}return new a(c)},a.compress=function(a){for(var b,c=0;b=g[c];c++)a=a.replace(new RegExp(b[1],"g"),b[0]);return a},a.decompress=function(a){for(var b,c=0;b=g[c];c++)a=a.replace(new RegExp(b[0],"g"),b[1]);return a},a}(),m=function(){var a=[];return{get:function(){return h&&(a=m.from(localStorage.getItem(d))),a},set:function(b){return a=b,h&&localStorage.setItem(d,m.to(a)),m},from:function(a){var b=[];if(a)for(var c,d=a.split(","),e=0;c=d[e];e++)b.push(new l(c));return b},to:function(a){return a.join(",")}}}(),n=function(){function a(a){g=0,h=0;var b=m.get();b.push(JSON.parse(a)),m.set(b)}function d(a,b){switch(a){case 500:case 502:case 503:case 504:e(b);break;default:i&&console.error("Unable to fetch suid data from server. ",b,a),g=0,h=0}}function e(e){if(0===g)return h=0,void(i&&console.error("Giving up fetching suid data after 5 attempts to fetch from server url: "+k.url));g--;var j=3e5,l=e.getResponseHeader("Retry-After");l&&(j=parseInt(l,10),isNaN(j)||(j=1e3*j)),m.get().length||j>6e4&&(j=6e4),c>100&&j>3e4&&(j=3e4),b||j>1e3&&(j=1e3),setTimeout(function(){f(k.url,{blocks:k.max-m.get().length},a,d)},j)}function f(a,b,c,d,e){var f,g,h=new XMLHttpRequest,i=[];for(g in b)b.hasOwnProperty(g)&&i.push(encodeURIComponent(g)+"="+encodeURIComponent(b[g]));f=i.join("&"),h.open("get",a+(f?(-1!==a.indexOf("?")?"&":"?")+f:""),!e),h.addEventListener("readystatechange",function(){4===this.readyState&&(200===this.status?c(this.responseText,this):d(this.status,this))}),h.addEventListener("error",function(){d(this,this.status)}),h.send()}var g=0,h=0;return{fetch:function(){if(!g||!((new Date).getTime()-h<5e3||c&&100>c)){var b=m.get();b.length<k.min&&(g=3,h=Date.now(),f(k.url,{blocks:k.max-b.length},a,d))}}}}();n.fetch(),window.Suid=l}();