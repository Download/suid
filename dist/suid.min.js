/*! [Suid 0.9.12](http://download.github.io/suid) copyright 2015 by [Stijn de Witt](http://StijnDeWitt.com), some rights reserved. Licensed under [Creative Commons Attribution 4.0 International (CC BY 4.0)](https://creativecommons.org/licenses/by/4.0/) */
!function(u,m,d){"function"==typeof define&&define.amd?define(d):"object"==typeof exports?module.exports=d():u[m]=d()}(this,"Suid",function(){"use strict";function a(){var a={server:"",min:3,max:4},b=document.querySelector("script[data-suid-server]");if(b||(b=document.querySelector("script[data-suid-options]")),!b)return a;var c,e=b.getAttribute("data-suid-server"),f=b.getAttribute("data-suid-options");if(f)try{c=JSON.parse(f.split("'").join('"'))}catch(g){return n&&console.error("Unable to parse suid options as JSON: '"+f+"'. Error was: ",g),a}return e&&(a.server=e),c&&c.min&&(a.min=c.min),c&&c.max&&(a.max=c.max),a}var b,c,e="Suid:",f=4,g=32,h=5e3,i="suidpool",j="suiddetect",k="0123456789abcdefghijklmnopqrstuvwxyz",l=function(a){try{return a.setItem(j,j),a.removeItem(j),!0}catch(b){return!1}}(localStorage),n="console"in window&&console.error&&console.warn,o=[],p=a(),Suid=function(){function Suid(a){return this instanceof Suid?(void 0===a&&(a=0),"string"==typeof a&&(a=Suid.fromString(a)),this.value=a instanceof Suid?a.value:a,void Number.call(this,this.value)):new Suid(a)}return Suid.prototype=Object.create(Number.prototype),Suid.prototype.constructor=Suid,Suid.NULL=Suid(0),Suid.prototype.toString=function(){return this.value.toString(36)},Suid.prototype.toJSON=function(){return e+this.toString()},Suid.prototype.valueOf=function(){return this.value},Suid.fromString=function(a){return new Suid(parseInt(a,36))},Suid.fromJSON=function(a){return null===a?null:(a.indexOf(e)||(a=a.substr(e.length)),Suid.fromString(a))},Suid.looksValid=function(a){if(!a)return!1;var b=a.length;if(!b||b>11)return!1;if(11===b&&k.indexOf(a.charAt(0))>2)return!1;for(var c=0;b>c;c++)if(-1===k.indexOf(a.charAt(c)))return!1;return!0},Suid.looksValidJSON=function(a){return a&&a.length?-1===a.indexOf(e)?!1:Suid.looksValid(a.substr(e.length)):!1},Suid.revive=function(a,b){return Suid.looksValidJSON(b)?Suid.fromJSON(b):b},Suid.next=function(){var a=q.get();if((a.length<p.min||!b&&a.length===p.min)&&(p.server?r.fetch():n&&console.warn("No suid server configured. Please add the data-suid-server attribute to the script tag or call Suid.config before generating IDs.")),!b){if(0===a.length)throw new Error("Unable to generate IDs. Suid block pool exhausted.");c=0,b=a.splice(0,1)[0],q.set(a)}var e=b+c*f;return c++,c>=g&&(b=null),new Suid(e)},Suid.config=function(a){return a&&(p.server=a.server||p.server,p.min=a.min||p.min,p.max=a.max||p.max),Suid.ready(),a?this:p},Suid.ready=function(a){var b=!!p.server&&q.get().length>0;return a&&o.push(a),b?setTimeout(function(){for(var a;a=o.shift();)a()},4):p.server&&r.fetch(),b},Suid}(),q=function(){var a=[];return{get:function(){return l&&(a=q.from(localStorage.getItem(i))),a},set:function(b){return a=b,l&&localStorage.setItem(i,q.to(a)),q},from:function(a){var b=[];if(a)for(var c,e=a.split(","),f=0;c=e[f];f++)b.push(new Suid(c));return b},to:function(a){return a.join(",")}}}(),r=function(){function a(a){j=0;var b=q.get();b.push(JSON.parse(a)),q.set(b),Suid.ready()}function e(a,b){switch(a){case 500:case 502:case 503:case 504:f(b);break;default:n&&console.error("Unable to fetch suid data from server. ",b,a),j=0}}function f(f){if(0===j)return void(n&&console.error("Giving up fetching suid data from server: "+p.server));j--;var h=3e5,k=f.getResponseHeader("Retry-After");k&&(h=parseInt(k,10),isNaN(h)||(h=1e3*h)),q.get().length||h>6e4&&(h=6e4),c>g/2&&h>3e4&&(h=3e4),b||h>2e3&&(h=2e3),setTimeout(function(){i(p.server,{blocks:p.max-q.get().length},a,e)},h)}function i(a,b,c,e,f){var g,h,i=new XMLHttpRequest,j=[];for(h in b)b.hasOwnProperty(h)&&j.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));g=j.join("&"),i.open("get",a+(g?(-1!==a.indexOf("?")?"&":"?")+g:""),!f),i.addEventListener("readystatechange",function(){4===this.readyState&&(200===this.status?c(this.responseText,this):e(this.status,this))}),i.addEventListener("error",function(){e(this,this.status)}),i.send()}var j=0,k=0;return{fetch:function(){if(!j||!((new Date).getTime()-k<h||c&&g/2>c)){var b=q.get();b.length<p.min&&(j=3,k=Date.now(),i(p.server,{blocks:p.max-b.length},a,e))}}}}();return Suid.ready(),Suid});
//# sourceMappingURL=suid.min.js.map