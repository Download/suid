/*! [ws.suid 0.10.1](https://download.github.io/suid). Copyright 2015 by [Stijn de Witt](http://StijnDeWitt.com). Some rights reserved. License: [CC-BY-4.0](https://creativecommons.org/licenses/by/4.0/) */
!function(u,m,d){var a;if(this&&this.log&&this.log.picolog&&(a=this.log),"object"==typeof exports){try{require.resolve("picolog"),a=require("picolog")}catch(b){}module.exports=d(a)}else"function"==typeof define&&define.amd?define(u,["require"],function(b){return d(b.defined&&b.defined("picolog")||b.c&&b.c.picolog?b("picolog"):a)}):this[m]=d(a)}("suid","Suid",function(a){"use strict";function b(){var a,b,c,e={};for(a=0;b=arguments[a++];)for(c in b)e[c]=b[c];return e}function c(c,e){var f={},g=b(e,c),h="object"==typeof document&&document.querySelector("script[data-suid-server]");if(h||(h="object"==typeof document&&document.querySelector("script[data-suid-options]")),h){var i=h.getAttribute("data-suid-options");if(i)try{f=JSON.parse(i.split("'").join('"'))}catch(j){a&&a.error("Unable to parse suid options as JSON: '"+i+"'. Error was: ",j)}f.url=h.getAttribute("data-suid-server"),g=b(g,f)}return g.configured=c||h,g}var e,f,g=2,h=64,i=5e3,j="suidpool",k="suiddetect",l="0123456789abcdefghijklmnopqrstuvwxyz",n=function(a){try{return a.setItem(k,k),a.removeItem(k),!0}catch(b){return!1}}("object"==typeof window&&window.localStorage),o=[],p="undefined"!=typeof window?window:"undefined"!=typeof global?global:{},q=c(p.Suid,{server:"/suid/suid.json",min:3,max:4}),Suid=function(){function Suid(a){return this instanceof Suid?(void 0===a&&(a=0),"string"==typeof a&&(a=parseInt(a,36)),this.value=a instanceof Suid?a.value:a,void Number.call(this,this.value)):new Suid(a)}return Suid.prototype=Object.create(Number.prototype),Suid.prototype.constructor=Suid,Suid.prototype.toString=function(){return this.value.toString(36)},Suid.prototype.toJSON=function(){return this.toString()},Suid.prototype.valueOf=function(){return this.value},Suid.prototype.compare=function(a){return a=Suid(a),this.value<a.value?-1:this.value>a.value?1:0},Suid.prototype.equals=function(a){return this.value===Suid(a).value},Suid.looksValid=function(a){if(!a)return!1;var b=a.length;if(!b||b>11)return!1;if(11===b&&l.indexOf(a.charAt(0))>2)return!1;for(var c=0;b>c;c++)if(-1===l.indexOf(a.charAt(c)))return!1;return!0},Suid.revive=function(a){var b=void 0===typeof a?function(){return!0}:function(b){return-1!==a.indexOf(b)};return"string"==typeof a&&(a=[a]),"function"==typeof a&&(b=a),function(a,c){return b(a,c)&&Suid.looksValid(c)?new Suid(c):c}},Suid.next=function(){var b=r.get();if((b.length<q.min||!e&&b.length===q.min)&&(q.server?s.fetch():a&&a.warn("No suid server configured. Please add the data-suid-server attribute to the script tag or call Suid.config before generating IDs.")),!e){if(0===b.length)throw new Error("Unable to generate IDs. Suid block pool exhausted.");f=0,e=b.splice(0,1)[0],r.set(b)}var c=e+f*g;return f++,f>=h&&(e=null),new Suid(c)},Suid.config=function(a){if(a){if(q=b(q,a),a.seed){var c=r.get();c.push(a.seed),r.set(c),delete q.seed}Suid.ready()}return q},Suid.ready=function(a){var b=r.get().length>0;return a&&o.push(a),b?setTimeout(function(){for(var a;a=o.shift();)a()},0):setTimeout(function(){s.fetch()},100),b},Suid}(),r=function(){var a=[];return{get:function(){return n&&(a=r.from(localStorage.getItem(j))),a},set:function(b){return a=b,n&&localStorage.setItem(j,r.to(a)),r},from:function(a){var b=[];if(a)for(var c,e=a.split(","),f=0;c=e[f];f++)b.push(new Suid(c));return b},to:function(a){return a.join(",")}}}(),s=function(){function b(a){k=0;var b=r.get();b.push(JSON.parse(a)),r.set(b),Suid.ready()}function c(b,c){switch(b){case 500:case 502:case 503:case 504:g(c);break;default:a&&a.error("Unable to fetch suid data from server. ",c,b),k=0}}function g(g){if(0===k)return void(a&&a.error("Giving up fetching suid data from server: "+q.server));k--;var i=3e5,l=g.getResponseHeader("Retry-After");l&&(i=parseInt(l,10),isNaN(i)||(i=1e3*i)),r.get().length||i>6e4&&(i=6e4),f>h/2&&i>3e4&&(i=3e4),e||i>2e3&&(i=2e3),setTimeout(function(){j(q.server,{blocks:q.max-r.get().length},b,c)},i)}function j(a,b,c,e,f){var g,h,i=new XMLHttpRequest,j=[];for(h in b)b.hasOwnProperty(h)&&j.push(encodeURIComponent(h)+"="+encodeURIComponent(b[h]));g=j.join("&"),i.open("get",a+(g?(-1!==a.indexOf("?")?"&":"?")+g:""),!f),i.addEventListener("readystatechange",function(){4===this.readyState&&(200===this.status?c(this.responseText,this):e(this.status,this))}),i.addEventListener("error",function(){e(this,this.status)}),i.send()}var k=0,l=0;return{fetch:function(){if(!("object"!=typeof window||k&&((new Date).getTime()-l<i||f&&h/2>f))){var a=r.get();a.length<q.min&&(k=3,l=Date.now(),j(q.server,{blocks:q.max-a.length},b,c))}}}}();return q.configured?Suid.configure(q):Suid.ready(),a&&a.info("Suid.js started."),Suid});
//# sourceMappingURL=suid.min.js.map