<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <title>Suid by Download</title>
  </head>

  <body>

    <header>
      <div class="container">
        <h1>Suid</h1>
        <h2>Distributed Service-Unique IDs that are short and sweet.</h2>

        <section id="downloads">
          <a href="https://github.com/Download/suid/zipball/master" class="btn">Download as .zip</a>
          <a href="https://github.com/Download/suid/tarball/master" class="btn">Download as .tar.gz</a>
          <a href="https://github.com/Download/suid" class="btn btn-github"><span class="icon"></span>View on GitHub</a>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <h1>
<a id="wssuid-v0100" class="anchor" href="#wssuid-v0100" aria-hidden="true"><span class="octicon octicon-link"></span></a>ws.suid <sub><sup>v0.10.0</sup></sub>
</h1>

<p><strong>Distributed Service-Unique IDs that are short and sweet.</strong> </p>

<p>Suids are IDs that are:</p>

<ul>
<li>Short</li>
<li>Unique across a service or site</li>
<li>Ordered</li>
<li>Easy for humans to read, write and pronounce</li>
<li>53 bits so they fit into a single Javascript or PHP Number, Java Long, SQL BigInt etc.</li>
<li>Sweet!</li>
</ul>

<h2>
<a id="download" class="anchor" href="#download" aria-hidden="true"><span class="octicon octicon-link"></span></a>Download</h2>

<ul>
<li>Commented (~7kB): <a href="https://github.com/Download/suid/releases/download/0.10.0/suid.js">suid.js</a>
</li>
<li>Minified (~3 KB): <a href="https://github.com/Download/suid/releases/download/0.10.0/suid.min.js">suid.min.js</a>
</li>
<li>Map file: <a href="https://github.com/Download/suid/releases/download/0.10.0/suid.min.js.map">suid.min.js.map</a>
</li>
</ul>

<h2>
<a id="cdn" class="anchor" href="#cdn" aria-hidden="true"><span class="octicon octicon-link"></span></a>CDN</h2>

<ul>
<li>Commented: <code>//cdn.rawgit.com/download/suid/0.10.0/dist/suid.js</code>
</li>
<li>Minified : <code>//cdn.rawgit.com/download/suid/0.10.0/dist/suid.min.js</code>
</li>
<li>Map file : <code>//cdn.rawgit.com/download/suid/0.10.0/dist/suid.min.js.map</code>
</li>
</ul>

<h2>
<a id="npm" class="anchor" href="#npm" aria-hidden="true"><span class="octicon octicon-link"></span></a>NPM</h2>

<ul>
<li><code>npm install --save-dev ws.suid</code></li>
</ul>

<h2>
<a id="bower" class="anchor" href="#bower" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bower</h2>

<ul>
<li><code>bower install download/suid --save</code></li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<ul>
<li>Include suid.js on your webpage</li>
<li>Configure the URL of the suid server</li>
<li>Call <code>Suid.next()</code> to generate IDs</li>
<li>Use options to provide seed data and control pool behavior</li>
</ul>

<h3>
<a id="configure-the-url-of-the-suid-server" class="anchor" href="#configure-the-url-of-the-suid-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configure the URL of the suid server</h3>

<p>This is the only mandatory configuration. Like all configuration in suid.js, it can be done in three ways:</p>

<ul>
<li>By setting a script attribute</li>
<li>By calling <code>Suid.configure(options)</code>
</li>
<li>By creating a global configuration object</li>
</ul>

<h4>
<a id="by-setting-a-script-attribute" class="anchor" href="#by-setting-a-script-attribute" aria-hidden="true"><span class="octicon octicon-link"></span></a>By setting a script attribute</h4>

<p>You can pass the URL to the suid server right in the script tag by setting
the attribute <code>data-suid-server</code> to the URL of the server:</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>//cdn.rawgit.com/download/suid/0.10.0/dist/suid.min.js<span class="pl-pds">"</span></span> 
        <span class="pl-e">data-suid-server</span>=<span class="pl-s"><span class="pl-pds">"</span>/suid/suid.json<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<h4>
<a id="by-calling-suidconfigureoptions" class="anchor" href="#by-calling-suidconfigureoptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>By calling <code>Suid.configure(options)</code>
</h4>

<p>Instead of using script attributes, once suid.js has loaded, you can call
<code>Suid.configure(options)</code>, where <code>options</code> is an options object:</p>

<div class="highlight highlight-source-js"><pre>Suid.configure({server<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>/suid.suid,json<span class="pl-pds">'</span></span>});</pre></div>

<h4>
<a id="by-creating-a-global-configuration-object" class="anchor" href="#by-creating-a-global-configuration-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>By creating a global configuration object</h4>

<p>Sometimes you want to set your configuration <em>before</em> loading your scripts. Suid.js allows for that.
If, by the time suid.js is loaded, an object exists in the global scope called <code>Suid</code>, suid.js will
pick it up and use it to configure itself before replacing it with the <code>Suid</code> function:</p>

<pre><code>&lt;script&gt;var Suid = {server:'/suid/suid.json'};&lt;/script&gt;
&lt;script src="//cdn.rawgit.com/download/suid/0.10.0/dist/suid.min.js"&gt;&lt;/script&gt;
</code></pre>

<h3>
<a id="call-suidnext-to-generate-ids" class="anchor" href="#call-suidnext-to-generate-ids" aria-hidden="true"><span class="octicon octicon-link"></span></a>Call <code>Suid.next()</code> to generate IDs</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> myId <span class="pl-k">=</span> Suid.<span class="pl-c1">next</span>();
<span class="pl-c1">alert</span>(myId);             <span class="pl-c">// 14she</span>
<span class="pl-c1">alert</span>(myId.<span class="pl-c1">valueOf</span>());   <span class="pl-c">// 1903154</span>
<span class="pl-k">var</span> halve <span class="pl-k">=</span> myId <span class="pl-k">/</span> <span class="pl-c1">2</span>;
<span class="pl-k">var</span> halveId <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Suid</span>(halve);
<span class="pl-c1">alert</span>(halve);            <span class="pl-c">// 951577</span>
<span class="pl-c1">alert</span>(halveId);          <span class="pl-c">// ke8p</span>
<span class="pl-k">var</span> src <span class="pl-k">=</span> {id<span class="pl-k">:</span> myId, name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>test<span class="pl-pds">'</span></span>};
<span class="pl-k">var</span> json <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.stringify(src);
<span class="pl-c1">alert</span>(json);             <span class="pl-c">// '{"id":"14she","name":"test"}'</span>
<span class="pl-k">var</span> dst <span class="pl-k">=</span> <span class="pl-c1">JSON</span>.<span class="pl-c1">parse</span>(json, Suid.revive(<span class="pl-s"><span class="pl-pds">'</span>id<span class="pl-pds">'</span></span>));
<span class="pl-c1">alert</span>(dst.<span class="pl-c1">id</span>);           <span class="pl-c">// 14she</span></pre></div>

<p><em>Don't create new IDs by adding to existing IDs!<br>
 Just call <code>Suid.next()</code> again.</em></p>

<h2>
<a id="options" class="anchor" href="#options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Options</h2>

<p>You can specify options by including the <code>data-suid-options</code> attribute in the script element 
and giving a pseudo-json options string, like so:</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>//cdn.rawgit.com/download/suid/0.10.0/dist/suid.min.js<span class="pl-pds">"</span></span> 
        <span class="pl-e">data-suid-server</span>=<span class="pl-s"><span class="pl-pds">"</span>suid/suid.json<span class="pl-pds">"</span></span>
        <span class="pl-e">data-suid-options</span>=<span class="pl-s"><span class="pl-pds">"</span>{'min':4, 'max':6, 'seed':['14she', '14sky']}<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<p>The pseudo-json is basically normal json but with single quotes instead of double.</p>

<p>When using the global configuration object or <code>Suid.configure</code> to specify options instead
of the script attributes, just add the extra options to the options object:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">// Before loading suid.js:</span>
<span class="pl-k">var</span> Suid <span class="pl-k">=</span> {server<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>/suid/suid.json<span class="pl-pds">'</span></span>, min<span class="pl-k">:</span><span class="pl-c1">4</span>, max<span class="pl-k">:</span><span class="pl-c1">6</span>, seed<span class="pl-k">:</span>[<span class="pl-s"><span class="pl-pds">'</span>14she<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>14sky<span class="pl-pds">'</span></span>]};
<span class="pl-c">// or after loading suid.js:</span>
Suid.configure({server<span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">'</span>/suid/suid.json<span class="pl-pds">'</span></span>, min<span class="pl-k">:</span><span class="pl-c1">4</span>, max<span class="pl-k">:</span><span class="pl-c1">6</span>, seed<span class="pl-k">:</span>[<span class="pl-s"><span class="pl-pds">'</span>14she<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>14sky<span class="pl-pds">'</span></span>]});</pre></div>

<h3>
<a id="seed-option" class="anchor" href="#seed-option" aria-hidden="true"><span class="octicon octicon-link"></span></a>Seed option</h3>

<p>The <code>seed</code> option allows you to pre-configure suid.js with the first suid blocks,
so it will be able to generate ID's right away. If you don't provide seed blocks,
and no suid blocks are in the pool in localstorage, suid.js will fire an Ajax 
request right away to fetch the first blocks. This does however cause some latency
and a small period in which suid.js will not be able to serve any IDs.</p>

<p>To provide seed blocks, we generate suid blocks on the server on the first request
and pass them to suid.js in option <code>seed</code>, using any of the methods discussed above.</p>

<p>E.g.:</p>

<div class="highlight highlight-source-js"><pre>Suid.configure({seed<span class="pl-k">:</span> [<span class="pl-s"><span class="pl-pds">'</span>14she<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>14sky<span class="pl-pds">'</span></span>]}); </pre></div>

<h3>
<a id="suid-pool-options" class="anchor" href="#suid-pool-options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Suid pool options</h3>

<p>The suid script fetches suid blocks from the suid server and stores them in a pool in 
<a href="http://www.w3.org/TR/webstorage/#storage">localStorage</a> 
(<a href="http://caniuse.com/#search=localstorage">browser support</a>). This pool is accessible from 
all tabs that are from the same domain, maximizing the efficient use of suid blocks. </p>

<p>You can control the behaviour of the pool with two settings:</p>

<ul>
<li>
<code>min</code>: Minimum number of suid blocks to keep in the pool, defaults to 3</li>
<li>
<code>max</code>: Maximum number of suid blocks to keep in the pool, defaults to 4</li>
</ul>

<p>Option <code>min</code> determines how low the amount of blocks in the pool may become before the script 
will request new blocks from the server. Option <code>max</code> determines how many blocks the script 
will fetch during each request in order to fill the pool up again. If your application has 
moments in which it consumes a lot of IDs in a short timeframe, or if your application is expected 
to be used offline for prolonged periods, choose a <code>min</code> that ensures enough IDs will always be 
in the pool to supply those IDs. If you want to reduce the number of requests for ID blocks 
(at the expense of more ID blocks going wasted when caches are cleared etc) choose a <code>max</code> that 
is a number of blocks higher then your <code>min</code>.</p>

<p>At most 8 blocks can be requested from the pool simultaneously (when using <code>suid-server-java</code>) 
so bear this in mind when configuring your pool. I would guess that the default settings are 
good enough for most people.</p>

<h2>
<a id="suid-pool-exhausted-exceptions" class="anchor" href="#suid-pool-exhausted-exceptions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Suid pool exhausted exceptions</h2>

<p>I have found that you will mostly get away with generating suids whenever you need them and
suid.js will be able to maintain the pool of suid blocks very effectively. However there is
always the possibility of the pool being empty for some reason. So if you want to play it safe
you should wrap calls to <code>Suid.next()</code> in a <code>try...catch</code> block as it will throw an error
when the pool is exhausted:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">try</span> {
    <span class="pl-k">var</span> id <span class="pl-k">=</span> Suid.<span class="pl-c1">next</span>();
} 
<span class="pl-k">catch</span>(e) {
    <span class="pl-c">// deal with it somehow... Either schedule a retry or show an error etc</span>
}</pre></div>

<p>Once the pool is filled this will be a very rare occurance, but you are guaranteed
to get it when you have an empty localstorage and load a page containing this code:</p>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">script</span> <span class="pl-e">src</span>=<span class="pl-s"><span class="pl-pds">"</span>//cdn.rawgit.com/download/suid/0.10.0/dist/suid.min.js<span class="pl-pds">"</span></span> 
        <span class="pl-e">data-suid-server</span>=<span class="pl-s"><span class="pl-pds">"</span>suid/suid.json<span class="pl-pds">"</span></span>&gt;&lt;/<span class="pl-ent">script</span>&gt;
&lt;<span class="pl-ent">script</span>&gt;</pre></div>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> x <span class="pl-k">=</span> Suid.<span class="pl-c1">next</span>();</pre></div>

<div class="highlight highlight-text-xml"><pre>&lt;/<span class="pl-ent">script</span>&gt;</pre></div>

<p>This is because suid.js was not given any seed blocks and the first ajax request to
fill up the pool will not have returned yet. You can deal with this in three ways:</p>

<ul>
<li>By providing seed data as discussed above</li>
<li>By ignoring this possibility (feasible if you only generate ID's after user interaction)</li>
<li>By attaching a listener to <code>Suid.ready</code>
</li>
</ul>

<p>If the initial period with empty pool is all you fear, you can add a listener to
<code>Suid.ready</code> like this:</p>

<div class="highlight highlight-source-js"><pre>Suid.ready(<span class="pl-k">function</span>(){
    <span class="pl-k">var</span> x <span class="pl-k">=</span> Suid.<span class="pl-c1">next</span>(); <span class="pl-c">// this will not fail</span>
});</pre></div>

<p>Personally I am not wrapping my calls to <code>Suid.next()</code> in a <code>try...catch</code> block, but
I like living on the edge. :)</p>

<h2>
<a id="need-a-server" class="anchor" href="#need-a-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Need a server?</h2>

<p>Check out the Java EE implementation: <a href="http://download.github.io/suid-server-java/">suid-server-java</a></p>

<h2>
<a id="api-documentation" class="anchor" href="#api-documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>API documentation</h2>

<p>Please refer to the <a href="https://cdn.rawgit.com/download/suid/0.10.0/doc/ws.suid.Suid.html">Suid JS API documentation</a> 
for details on the API.</p>

<h2>
<a id="why-suids" class="anchor" href="#why-suids" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why Suids?</h2>

<p>Database IDs are ususally generated by the database itself, using auto-increment. 
The big downside of this is that we need to interact with the server whenever we
need an ID. When we create new objects, we have to leave the ID field blank for
the server to fill in later. When we want to refer to those new objects, we can't
until we have created the new object on the server and have been issued an ID.
This creates a strong dependency on the server that is detrimental for offline apps.
Furthermore database ID's are only unique for the table they correspond with.
Having <em>just</em> an ID, we cannot know which record it corresponds with. We would like
to have IDs which are unique across all our tables. </p>

<p>To solve these issues we can use a distributed ID generator. We could use GUIDs
but they are loooooong. There are some nice solutions out there using randomness 
to generate short IDs, such as <a href="https://github.com/dylang/shortid">shortid</a>. 
However, random-based ID's have a balancing act between uniqueness and length. 
Make them too short and you <em>will</em> get collisions. Make them too long and they 
are... well... too long!  ;)</p>

<p>Also these ID generators don't generate ordered IDs. This can be an advantage (from 
a security perspective) but you also lose a lot of pleasant properties that come
with ordered IDs. One of which is that with ordered IDs you start with the shortest
possible IDs and end with the long ones. </p>

<p>So.. is there middle ground? The best of both worlds? I think so. Which is why I
built Suid.</p>

<h3>
<a id="distributed-but-coordinated" class="anchor" href="#distributed-but-coordinated" aria-hidden="true"><span class="octicon octicon-link"></span></a>Distributed but coordinated</h3>

<p>Suids are coordinated by a central server. The server hands out ID blocks, each of
which allows an ID generator to generate up to 64 IDs without any further need
for communication with the server. It's implementation is inspired by 
<a href="http://code.flickr.net/2010/02/08/ticket-servers-distributed-unique-primary-keys-on-the-cheap/">the mechanism Flickr uses</a>
for generating their IDs. Flickr however serves IDs one at a time, whereas Suid
servers hand out IDs in blocks of 64 to minimize network overhead and facilitate
longer periods of offline usage.</p>

<h3>
<a id="short" class="anchor" href="#short" aria-hidden="true"><span class="octicon octicon-link"></span></a>Short</h3>

<p>Suids fit in 53-bits, which means they can be treated as a native number in all 
major programming languages, including PHP and Javascript. And because they are
ordered, they start out <em>very</em> short and only grow longer as time goes by and
more and more of them are issued. They will never become longer than 11 characters.
Here is an example of the length of the ID as more and more IDs get issued:</p>

<pre><code>Before 1K: XX
After 1K:  XXX
After 1M:  XXXXX
After 1G:  XXXXXXX
After 1T:  XXXXXXXXX
After 1P:  XXXXXXXXXXX
</code></pre>

<p>The first thousand IDs can be encoded using just two characters. Between a thousand 
and a million IDs can be generated that use three to four characters. From a million
to a billion IDs can be generated using five to six characters. Only after we have
issued dozens of billions of IDs do we get IDs of 8 characters or longer.</p>

<p>The total ID space of a suid can contain <code>9,007,199,254,740,992</code> or 
9 quadrillion, 7 trillion, 199 billion, 254 million, 740 thousand 992 IDs.  :)</p>

<h3>
<a id="sweet" class="anchor" href="#sweet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sweet</h3>

<p>The default representation of a Suid uses base-36, an alphabet with 36 different symbols 
(<code>0..9a..z</code>), and are easy for humans to read, write and pronounce, as well as URL-safe.
Using (only lowercase!) letters in addition to the decimals actually makes the IDs easier
for humans to work with, Just compare:</p>

<pre><code>14she
1903154
</code></pre>

<p>Especially when having to read an ID to someone over the phone, adding in uppercase letters
and special symbols such as dash <code>-</code>, tilde <code>~</code> and underscore <code>_</code> makes the process very
error-prone and tedious.</p>

<h2>
<a id="technical-background" class="anchor" href="#technical-background" aria-hidden="true"><span class="octicon octicon-link"></span></a>Technical background</h2>

<p>The 53 bits in a suid are distributed over a 64-bit long as depicted below:</p>

<pre><code>                 HIGH INT                                         LOW INT
 _______________________________________________________________________________________________
|                                               |                                               |
| 0000 0000 | 000b bbbb | bbbb bbbb | bbbb bbbb | bbbb bbbb | bbbb bbbb | bbbb bbbb | biii iiis |
|_______________________________________________|_______________________________________________|

0 = 11 reserved bits
b = 46 block bits
i = 6 ID bits
s = 1 shard bit
</code></pre>

<p>The first 11 bits are reserved and always set to <code>0</code>. The next 46 bits are used for
the <code>block</code> number. These are handed out by a centralized server. Then there are 6 <code>ID</code>
bits which are to be filled in by the generator. The last bit is reserved for the <code>shard</code>
ID. To prevent a single point of failure, two separate hosts can be handing out ID's for 
a certain domain, each with their own <code>shard</code> ID (<code>0</code> or <code>1</code>).</p>

<p>When encoded to JSON, suids are represented as strings, e.g.: <code>'14she'</code>. The API offers 
a <a href="https://cdn.rawgit.com/download/suid/0.10.0/doc/ws.suid.Suid.html#toJSON">toJSON</a> method, 
as well as a <a href="//cdn.rawgit.com/download/suid/0.10.0/doc/ws.suid.Suid.html#.Suid.revive">revive</a> 
function that generates a reviver for a field in an object.</p>

<h2>
<a id="copyright" class="anchor" href="#copyright" aria-hidden="true"><span class="octicon octicon-link"></span></a>Copyright</h2>

<p>Copyright (c) 2015 by <a href="http://StijnDeWitt.com">Stijn de Witt</a>. Some rights reserved.</p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p><a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International (CC BY 4.0)</a></p>
      </section>
    </div>

    
  </body>
</html>
